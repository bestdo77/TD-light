# TDlight

åŸºäº TDengine æ—¶åºæ•°æ®åº“çš„å¤©æ–‡å…‰å˜æ›²çº¿ç®¡ç†ä¸åˆ†ç±»ç³»ç»Ÿã€‚

æ”¯æŒå¤§è§„æ¨¡å¤©æ–‡æ—¶åºæ•°æ®çš„é«˜æ•ˆå­˜å‚¨ã€å¿«é€Ÿæ£€ç´¢å’Œæ™ºèƒ½åˆ†ç±»ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸŒ **é”¥å½¢æ£€ç´¢** | ä»¥å¤©çƒåæ ‡ä¸ºä¸­å¿ƒï¼ŒæŒ‰åŠå¾„æœç´¢å¤©ä½“ |
| ğŸ“¦ **çŸ©å½¢æ£€ç´¢** | æŒ‰ RA/DEC èŒƒå›´æ‰¹é‡æŸ¥è¯¢ |
| ğŸ“ˆ **å…‰å˜æ›²çº¿å¯è§†åŒ–** | äº¤äº’å¼å›¾è¡¨å±•ç¤ºæ—¶åºæµ‹å…‰æ•°æ® |
| ğŸ¤– **æ™ºèƒ½åˆ†ç±»** | åŸºäº LightGBM çš„å˜æ˜Ÿè‡ªåŠ¨åˆ†ç±» |
| ğŸ“¥ **æ•°æ®å¯¼å…¥** | Web ç•Œé¢ä¸€é”®å¯¼å…¥ CSV æ ¼å¼æ•°æ® |
| ğŸŒ **3D å¤©çƒ** | WebGL æ¸²æŸ“çš„ä¸‰ç»´å¤©çƒå¯è§†åŒ– |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµè§ˆå™¨ (å‰ç«¯)                              â”‚
â”‚   index.html + app.js (Three.js 3D / Chart.js / SSE å®æ—¶é€šä¿¡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTP/SSE
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      web_api (C++ åç«¯)                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ£€ç´¢ API   â”‚  â”‚  åˆ†ç±» API   â”‚  â”‚      æ•°æ®å¯¼å…¥ API        â”‚  â”‚
â”‚  â”‚ cone_search â”‚  â”‚  classify   â”‚  â”‚  catalog_importer       â”‚  â”‚
â”‚  â”‚region_searchâ”‚  â”‚  (è°ƒç”¨ Py)  â”‚  â”‚  lightcurve_importer    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                â”‚                     â”‚                â”‚
â”‚         â–¼                â–¼                     â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    TDengine C å®¢æˆ·ç«¯                         â”‚â”‚
â”‚  â”‚                      (libtaos.so)                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TDengine æ—¶åºæ•°æ®åº“ (Apptainer å®¹å™¨)            â”‚
â”‚                                                                 â”‚
â”‚   è¶…çº§è¡¨: lightcurves                                            â”‚
â”‚   â”œâ”€â”€ æ ‡ç­¾: healpix_id, source_id, ra, dec, cls                 â”‚
â”‚   â””â”€â”€ æ•°æ®: ts, band, mag, mag_error, flux, flux_error, jd_tcb  â”‚
â”‚                                                                 â”‚
â”‚   VGroups: 128 (æ”¯æŒçº¦ 2 ä¸ªå®Œæ•´æ•°æ®åº“)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è¿æ¥è¯´æ˜

1. **å‰ç«¯ (index.html + app.js)**
   - ä½¿ç”¨ Fetch API è°ƒç”¨åç«¯ REST æ¥å£
   - ä½¿ç”¨ Server-Sent Events (SSE) æ¥æ”¶åˆ†ç±»/å¯¼å…¥è¿›åº¦
   - Three.js æ¸²æŸ“ 3D å¤©çƒï¼ŒChart.js ç»˜åˆ¶å…‰å˜æ›²çº¿

2. **åç«¯ (web_api.cpp)**
   - çº¯ C++ å®ç°çš„ HTTP æœåŠ¡å™¨
   - ä½¿ç”¨ HEALPix è¿›è¡Œå¤©çƒåƒç´ åŒ–åŠ é€Ÿæ£€ç´¢
   - é€šè¿‡ `system()` è°ƒç”¨ Python åˆ†ç±»è„šæœ¬
   - é€šè¿‡ `system()` è°ƒç”¨ C++ å¯¼å…¥å™¨

3. **åˆ†ç±»æ¨¡å— (classify_pipeline.py)**
   - ç”± web_api é€šè¿‡å­è¿›ç¨‹è°ƒç”¨
   - ä½¿ç”¨ feets åº“æå–å…‰å˜æ›²çº¿ç‰¹å¾
   - ä½¿ç”¨é¢„è®­ç»ƒ LightGBM æ¨¡å‹è¿›è¡Œåˆ†ç±»
   - é«˜ç½®ä¿¡åº¦ç»“æœè‡ªåŠ¨å†™å› TDengine

4. **æ•°æ®å¯¼å…¥å™¨ (catalog_importer / lightcurve_importer)**
   - ç‹¬ç«‹ C++ ç¨‹åºï¼Œ64 çº¿ç¨‹å¹¶è¡Œå¯¼å…¥
   - é€šè¿‡ web_api å¯åŠ¨ï¼Œè¿›åº¦é€šè¿‡æ–‡ä»¶é€šä¿¡
   - å‰ç«¯é€šè¿‡ SSE å®æ—¶æ˜¾ç¤ºè¿›åº¦

---

## ğŸ–¥ï¸ è¿è¡Œç¯å¢ƒ

### ç¯å¢ƒæ¦‚è¿°

æœ¬ç³»ç»Ÿä½¿ç”¨ **Conda ç®¡ç†ç¯å¢ƒ** + **Apptainer å®¹å™¨è¿è¡Œ TDengine**ï¼š

- Apptainer é€šè¿‡ Conda å®‰è£…
- TDengine æœåŠ¡è¿è¡Œåœ¨ Apptainer å®¹å™¨å†…
- Web æœåŠ¡å’Œåˆ†ç±»è„šæœ¬è¿è¡Œåœ¨å®¹å™¨å¤–ï¼ˆConda ç¯å¢ƒï¼‰
- å®¹å™¨é€šè¿‡æŒ‚è½½è®¿é—® Conda ç¯å¢ƒå’Œæ•°æ®æ–‡ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®¿ä¸»æœº (Linux)                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Conda ç¯å¢ƒ (tdlight / feets)           â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚   Python 3.10 + numpy + lightgbm + feets + taospy   â”‚ â”‚
â”‚  â”‚   apptainer (é€šè¿‡ conda-forge å®‰è£…)                  â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚   è¿è¡Œ: web_api, classify_pipeline.py, importers    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                               â”‚
â”‚                          â”‚ æŒ‚è½½                          â”‚
â”‚                          â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Apptainer å®¹å™¨ (tdengine-fs)              â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚   TDengine 3.3.x æœåŠ¡ (taosd)                       â”‚ â”‚
â”‚  â”‚   ç›‘å¬ç«¯å£: 6030-6049                               â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚   æŒ‚è½½:                                              â”‚
â”‚  â”‚     - /app â†’ é¡¹ç›®ç›®å½•                                â”‚
â”‚  â”‚     - Conda ç¯å¢ƒè·¯å¾„                                 â”‚
â”‚  â”‚     - æ•°æ®ç›®å½•                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| æ“ä½œç³»ç»Ÿ | Ubuntu 20.04+ | ä»…æ”¯æŒ Linux |
| Conda | Miniconda/Anaconda | ç¯å¢ƒç®¡ç† |
| Apptainer | 1.1+ | é€šè¿‡ conda å®‰è£… |
| TDengine | 3.3.x | å®¹å™¨å†…è¿è¡Œ |
| GCC | 7+ | C++ ç¼–è¯‘ |

---

## ğŸ“¦ å®‰è£…æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourname/TDlight.git
cd TDlight
```

### 2. åˆ›å»º Conda ç¯å¢ƒ

```bash
# åˆ›å»ºä¸»ç¯å¢ƒ
conda create -n tdlight python=3.8 -y
conda activate tdlight

# å®‰è£… Apptainer
conda install -c conda-forge apptainer -y

# å®‰è£… Python ä¾èµ–
pip install numpy pandas scikit-learn lightgbm taospy feets taospy numpy pandas lightgbm

```

### 3. é…ç½® TDengine å®¹å™¨

é¡¹ç›®å·²åŒ…å« `tdengine-fs/` å®¹å™¨ç›®å½•ã€‚å¦‚éœ€é‡å»ºï¼š

```bash
apptainer build --sandbox tdengine-fs docker://tdengine/tdengine:3.3.2.0
```

### 4. ç¼–è¾‘é…ç½®æ–‡ä»¶

```bash
cp config.json.example config.json
# ä¿®æ”¹ python è·¯å¾„æŒ‡å‘ä½ çš„ feets ç¯å¢ƒ
vim config.json
```

ä¸»è¦é…ç½®é¡¹ï¼š

```json
{
    "database": {
        "host": "localhost",
        "port": 6041,
        "name": "your_database_name"
    },
    "paths": {
        "python": "/path/to/conda/envs/feets/bin/python"
    }
}
```

### 5. ç¼–è¯‘ C++ ç»„ä»¶

```bash
cd web
./build.sh

cd ../insert
./build.sh
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ TDengine å®¹å™¨
conda activate tdlight
./start_env.sh
# å®¹å™¨å†…æ‰§è¡Œ: taosd &

# ç»ˆç«¯ 2: å¯åŠ¨ Web æœåŠ¡
conda activate tdlight
cd web
export LD_LIBRARY_PATH=../libs:$LD_LIBRARY_PATH
./web_api
```

### 7. è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:5001**

---

## ğŸ“Š æ•°æ®å¯¼å…¥

### å¯¼å…¥æ–¹å¼

é€šè¿‡ Web ç•Œé¢ â†’ "æ•°æ®å¯¼å…¥" æ ‡ç­¾é¡µæ“ä½œã€‚

### å¿…éœ€æ–‡ä»¶

å¯¼å…¥å…‰å˜æ›²çº¿æ•°æ®æ—¶ï¼Œ**å¿…é¡»åŒæ—¶æä¾›åæ ‡æ–‡ä»¶**ï¼š

| æ–‡ä»¶ | è¯´æ˜ | å¿…éœ€ |
|------|------|------|
| å…‰å˜æ›²çº¿ç›®å½• | åŒ…å«æ¯ä¸ªå¤©ä½“çš„ CSV æ–‡ä»¶ | âœ… |
| åæ ‡æ–‡ä»¶ | åŒ…å«æ‰€æœ‰å¤©ä½“çš„ RA/DEC åæ ‡ | âœ… |

åæ ‡æ–‡ä»¶ç”¨äºï¼š
- è®¡ç®— HEALPix ç´¢å¼•ï¼ˆåŠ é€Ÿç©ºé—´æ£€ç´¢ï¼‰
- ä¸ºæ¯ä¸ªå¤©ä½“åˆ›å»ºå­è¡¨æ—¶è®¾ç½® TAGS

### æ•°æ®æ ¼å¼

**å…‰å˜æ›²çº¿ CSV**ï¼ˆæ¯ä¸ªå¤©ä½“ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶ååŒ…å« source_idï¼‰ï¼š

```csv
source_id,band,time,mag,mag_error,flux,flux_error
12345678,G,2015.5,15.234,0.002,1234.5,2.5
12345678,G,2015.6,15.238,0.003,1230.2,3.1
...
```

**åæ ‡æ–‡ä»¶ CSV**ï¼ˆä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å¤©ä½“ï¼‰ï¼š

```csv
source_id,ra,dec
12345678,180.123,-45.678
12345679,181.456,-44.321
...
```

### æ•°æ®åº“è¡Œä¸º

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| æ•°æ®åº“ä¸å­˜åœ¨ | è‡ªåŠ¨åˆ›å»ºï¼Œ128 VGroups |
| æ•°æ®åº“å·²å­˜åœ¨ | ç»§ç»­ä½¿ç”¨ |
| è¡¨å·²å­˜åœ¨ | è·³è¿‡åˆ›å»º |
| æ’å…¥æ–°æ•°æ® | **è¿½åŠ **åˆ°è¡¨ä¸­ |
| æ—¶é—´æˆ³å†²çª | **è¦†ç›–**æ—§è®°å½• |

> âš ï¸ **VGroups é™åˆ¶**ï¼šé»˜è®¤é…ç½® `supportVnodes=256`ï¼Œæ¯ä¸ªæ•°æ®åº“ä½¿ç”¨ 128 VGroupsã€‚
> è¿™æ„å‘³ç€ç³»ç»ŸåŒæ—¶æœ€å¤šæ”¯æŒçº¦ **2 ä¸ªå®Œæ•´æ•°æ®åº“**ã€‚
> å¯¼å…¥å‰è¯·é€šè¿‡"æ•°æ®åº“ç®¡ç†"åˆ é™¤ä¸éœ€è¦çš„æ•°æ®åº“é‡Šæ”¾èµ„æºã€‚

---

## ğŸ” æ£€ç´¢åŠŸèƒ½

### é”¥å½¢æ£€ç´¢ (Cone Search)

ä»¥æŒ‡å®šå¤©çƒåæ ‡ä¸ºåœ†å¿ƒï¼ŒæŒ‰åŠå¾„æœç´¢ï¼š

- è¾“å…¥ï¼šRA (åº¦), DEC (åº¦), åŠå¾„ (è§’åˆ†)
- ä½¿ç”¨ HEALPix ç´¢å¼•åŠ é€Ÿ

### çŸ©å½¢æ£€ç´¢ (Region Search)

æŒ‰ RA/DEC èŒƒå›´æ‰¹é‡æŸ¥è¯¢ï¼š

- è¾“å…¥ï¼šRA èŒƒå›´, DEC èŒƒå›´
- é€‚åˆæ‰¹é‡è·å–åŒºåŸŸå†…å¤©ä½“

---

## ğŸ¤– åˆ†ç±»åŠŸèƒ½

### åˆ†ç±»æµç¨‹

1. é€‰æ‹©è¦åˆ†ç±»çš„å¤©ä½“
2. ç‚¹å‡»"å¼€å§‹åˆ†ç±»"
3. ç³»ç»Ÿè‡ªåŠ¨ï¼š
   - ä»æ•°æ®åº“æå–å…‰å˜æ›²çº¿
   - ä½¿ç”¨ feets æå– 15ä¸ª å¤©æ–‡ç‰¹å¾
   - LightGBM æ¨¡å‹é¢„æµ‹å˜æ˜Ÿç±»å‹
   - é«˜äºé˜ˆå€¼çš„ç»“æœå†™å›æ•°æ®åº“


### ç½®ä¿¡åº¦é˜ˆå€¼

åœ¨"ç³»ç»Ÿè®¾ç½®"ä¸­å¯è°ƒæ•´ï¼š

- é«˜äºé˜ˆå€¼ï¼šè‡ªåŠ¨å†™å›æ•°æ®åº“
- ä½äºé˜ˆå€¼ï¼šä»…æ˜¾ç¤ºï¼Œä¸ä¿å­˜

---

## ğŸ“ ç›®å½•ç»“æ„

```
TDlight/
â”œâ”€â”€ config.json          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ start_env.sh         # å®¹å™¨å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ web/                 # Web æœåŠ¡
â”‚   â”œâ”€â”€ web_api.cpp      # C++ HTTP åç«¯
â”‚   â”œâ”€â”€ index.html       # å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ app.js           # å‰ç«¯äº¤äº’é€»è¾‘
â”‚   â””â”€â”€ build.sh         # ç¼–è¯‘è„šæœ¬
â”‚
â”œâ”€â”€ class/               # åˆ†ç±»æ¨¡å—
â”‚   â””â”€â”€ classify_pipeline.py  # åˆ†ç±»æµæ°´çº¿
â”‚
â”œâ”€â”€ insert/              # æ•°æ®å¯¼å…¥å™¨
â”‚   â”œâ”€â”€ catalog_importer.cpp      # æ˜Ÿè¡¨å¯¼å…¥
â”‚   â”œâ”€â”€ lightcurve_importer.cpp   # å…‰å˜æ›²çº¿å¯¼å…¥
â”‚   â””â”€â”€ build.sh
â”‚
â”œâ”€â”€ classifier/          # é¢„è®­ç»ƒæ¨¡å‹
â”‚   â”œâ”€â”€ lgbm_111w_model.pkl
â”‚   â””â”€â”€ metadata.pkl
â”‚
â”œâ”€â”€ libs/                # C++ è¿è¡Œæ—¶åº“
â”œâ”€â”€ include/             # C++ å¤´æ–‡ä»¶
â”œâ”€â”€ config/              # TDengine å®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ data/                # æ•°æ®æ–‡ä»¶ç›®å½•
â””â”€â”€ tdengine-fs/         # Apptainer å®¹å™¨
```

---

## âš™ï¸ API å‚è€ƒ

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/cone_search` | GET | é”¥å½¢æ£€ç´¢ |
| `/api/region_search` | GET | çŸ©å½¢æ£€ç´¢ |
| `/api/lightcurve/{table}` | GET | è·å–å…‰å˜æ›²çº¿ |
| `/api/classify_objects` | POST | å¯åŠ¨åˆ†ç±»ä»»åŠ¡ |
| `/api/classify_stream` | GET (SSE) | åˆ†ç±»è¿›åº¦æµ |
| `/api/import/start` | POST | å¯åŠ¨æ•°æ®å¯¼å…¥ |
| `/api/import/stream` | GET (SSE) | å¯¼å…¥è¿›åº¦æµ |
| `/api/import/stop` | POST | åœæ­¢å¯¼å…¥ |
| `/api/config` | GET/POST | è·å–/ä¿®æ”¹é…ç½® |
| `/api/config/reload` | GET | é‡è½½é…ç½®åˆ°åç«¯ |
| `/api/databases` | GET | åˆ—å‡ºæ•°æ®åº“ |
| `/api/database/drop` | POST | åˆ é™¤æ•°æ®åº“ |

---

## ğŸ› å¸¸è§é—®é¢˜

### ç¼–è¯‘æŠ¥é”™ï¼šæ‰¾ä¸åˆ°å¤´æ–‡ä»¶

ç¡®ä¿åœ¨å¯¹åº”ç›®å½•æ‰§è¡Œç¼–è¯‘ï¼š

```bash
cd web && ./build.sh
cd insert && ./build.sh
```

### è¿è¡Œæ—¶æ‰¾ä¸åˆ° .so æ–‡ä»¶

è®¾ç½®åº“è·¯å¾„ï¼š

```bash
export LD_LIBRARY_PATH=/path/to/TDlight/libs:$LD_LIBRARY_PATH
```

### æ— æ³•è¿æ¥ TDengine

1. ç¡®è®¤å®¹å™¨å†… taosd å·²å¯åŠ¨
2. æ£€æŸ¥ `config.json` ä¸­çš„æ•°æ®åº“é…ç½®
3. æ£€æŸ¥ç«¯å£ 6041 æ˜¯å¦å¯è®¿é—®

### VNodes exhausted é”™è¯¯

æ•°æ®åº“ VGroups èµ„æºè€—å°½ã€‚è§£å†³æ–¹æ¡ˆï¼š

1. é€šè¿‡ Web ç•Œé¢åˆ é™¤ä¸éœ€è¦çš„æ•°æ®åº“
2. æˆ–å¢åŠ  `config/taos_cfg/taos.cfg` ä¸­çš„ `supportVnodes` å€¼

### åˆ†ç±»æ— ç»“æœ

1. ç¡®è®¤ `config.json` ä¸­ `python` è·¯å¾„æ­£ç¡®
2. ç¡®è®¤ feets ç¯å¢ƒä¸­ä¾èµ–å®Œæ•´
3. æŸ¥çœ‹ `class/` ç›®å½•ä¸‹çš„æ—¥å¿—

---

## ğŸ“ å¤§æ–‡ä»¶è·å–

ä»¥ä¸‹æ–‡ä»¶å› ä½“ç§¯è¿‡å¤§æœªåŒ…å«åœ¨ä»“åº“ä¸­ï¼Œå¦‚æœ‰éœ€è¦è¯·è”ç³»ä½œè€…è·å–ï¼š

| æ–‡ä»¶ | å¤§å° | è·å–æ–¹å¼ |
|------|------|----------|
| `classifier/lgbm_111w_model.pkl` | ~250MB | è”ç³»ä½œè€…è·å–é¢„è®­ç»ƒæ¨¡å‹ |
| `data/` | - | ç”¨æˆ·è‡ªå¤‡å¤©æ–‡æ•°æ® |
| `tdengine-fs/` | ~2GB | ä½¿ç”¨ `apptainer build` æ„å»ºå®¹å™¨ |

### TDengine å®¢æˆ·ç«¯åº“

`libs/` ç›®å½•ä¸‹çš„ TDengine åº“æ–‡ä»¶éœ€ä»å®˜ç½‘è·å–ï¼š

1. è®¿é—® [TDengine å®˜ç½‘](https://docs.taosdata.com/releases/tdengine/)
2. ä¸‹è½½ **TDengine 3.3.7.5** ç‰ˆæœ¬ï¼ˆLinux amd64ï¼‰
3. è§£å‹åå°† `driver/libtaos.so*` å¤åˆ¶åˆ° `libs/` ç›®å½•

```bash
# ç¤ºä¾‹
wget https://www.taosdata.com/assets-download/3.0/TDengine-client-3.3.7.5-Linux-x64.tar.gz
tar -xzf TDengine-client-3.3.7.5-Linux-x64.tar.gz
cp TDengine-client-3.3.7.5/driver/libtaos.so* TDlight/libs/
```

**è”ç³»æ–¹å¼**ï¼šå¦‚éœ€é¢„è®­ç»ƒæ¨¡å‹/éƒ¨ç½²ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³» 3023244355@tju.edu.cnã€‚

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

- [TDengine](https://www.taosdata.com/) - é«˜æ€§èƒ½æ—¶åºæ•°æ®åº“
- [HEALPix](https://healpix.jpl.nasa.gov/) - å¤©çƒåƒç´ åŒ–æ–¹æ¡ˆ
- [feets](https://feets.readthedocs.io/) - å¤©æ–‡ç‰¹å¾æå–
- [LightGBM](https://lightgbm.readthedocs.io/) - æ¢¯åº¦æå‡æ¡†æ¶
- [Three.js](https://threejs.org/) - WebGL 3D æ¸²æŸ“
- [Chart.js](https://www.chartjs.org/) - å›¾è¡¨å¯è§†åŒ–
